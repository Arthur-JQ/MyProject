{% extends 'base.html' %}

{% block content %}
<div class="favorite-page">
    <div class="favorite-card">
        <h2 class="favorite-card__title">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
        <p class="favorite-card__subtitle">
            –ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–≤–∞—Ä—ã, —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –≤ localStorage.
        </p>

        <div class="favorite-card__body">
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç -->
            <div class="favorite-empty" id="favorite-empty">
                –ü–æ–∫–∞ —Ç—É—Ç –ø—É—Å—Ç–æ üôà<br>
                –î–æ–±–∞–≤—å —á—Ç–æ-–Ω–∏–±—É–¥—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º–µ–Ω—é.
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ -->
            <table class="favorite-table" id="favorite-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–¶–µ–Ω–∞</th>
                        <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                        <th>–°—É–º–º–∞</th>
                    </tr>
                </thead>
                <tbody id="favorite-body">
                    {# —Å—Ç—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS #}
                </tbody>
            </table>

        

            <!-- –ë–ª–æ–∫ –ò—Ç–æ–≥–æ -->
            <div class="favorite-total" id="favorite-total">
                <span class="favorite-total__label">–ò—Ç–æ–≥–æ:</span>
                <span class="favorite-total__value" id="favorite-total-value">0 ‚ÇΩ</span>
            </div>
        </div>
    </div>
</div>

<style>
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
   
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const table = document.getElementById('favorite-table');
        const tbody = document.getElementById('favorite-body');
        const emptyBlock = document.getElementById('favorite-empty');
        const totalBlock = document.getElementById('favorite-total');
        const totalValue = document.getElementById('favorite-total-value');

        const keys = Object.keys(localStorage);
        let hasRows = false;
        let grandTotal = 0;

        for (const key of keys) {
            let data;
            try {
                data = JSON.parse(localStorage.getItem(key));
            } catch (e) {
                continue; // –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ JSON ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
            }

            // –û–∂–∏–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Ñ–æ—Ä–º–∞—Ç–∞ {id, name, price, count}
            if (!data || typeof data !== 'object') continue;
            if (!('name' in data) || !('price' in data) || !('count' in data)) continue;

            const id = data.id ?? key;
            const name = data.name;
            const price = Number(data.price) || 0;
            const count = Number(data.count) || 1;
            const total = price * count;
            grandTotal += total;

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${id}</td>
                <td>${name}</td>
                <td>${price.toLocaleString('ru-RU')} ‚ÇΩ</td>
                <td>${count}</td>
                <td>${total.toLocaleString('ru-RU')} ‚ÇΩ</td>
            `;
            tbody.appendChild(tr);
            hasRows = true;
        }

        if (hasRows) {
            emptyBlock.style.display = 'none';
            table.style.display = 'table';

            totalBlock.style.display = 'flex';
            totalValue.textContent = grandTotal.toLocaleString('ru-RU') + ' ‚ÇΩ';
        } else {
            emptyBlock.style.display = 'block';
            table.style.display = 'none';
            totalBlock.style.display = 'none';
        }
    });
</script>
{% endblock %}